# âš¡ SparkForge: The Crucible Engine

![Version](https://img.shields.io/badge/version-2.0.0-blue) ![Module](https://img.shields.io/badge/module-Oracle_Grounded-green) ![Workflow](https://img.shields.io/badge/workflow-The_Crucible-orange)

> **ä½¿å‘½ (Mission)**: é€šè¿‡ **Oracle äº‹å®é”šå®š** ä¸ **å¯¹æŠ—å¼è¾©è®º** çš„åŒé‡ç†”ç‚‰ï¼Œå°†æŒ¥å‘çš„åŸå§‹åˆ›æ„é”»é€ æˆç»å¾—èµ·ç°å®æ£€éªŒçš„å·¥ä¸šçº§æ‰§è¡Œæ–¹æ¡ˆã€‚

---

## ğŸ§  æ ¸å¿ƒç†å¿µï¼šThe Crucible (ç†”ç‚‰)

SparkForge ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡æ¡£ç”Ÿæˆå™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ª **è®¤çŸ¥ç†”ç‚‰**ã€‚å®ƒé€šè¿‡ **"The Crucible"**å·¥ä½œæµï¼Œå¼ºåˆ¶æ‰€æœ‰æ–‡æ¡£ç»å† "äº‹å®æ‰«æ -> æ¿€çƒˆè¾©è®º -> é€»è¾‘æ”¶æ•› -> å¤–ç§‘æ‰‹æœ¯" çš„è¿­ä»£å¾ªç¯ï¼Œç›´è‡³å…¶å˜æˆåšä¸å¯æ‘§çš„äº¤ä»˜ç‰©ã€‚

## ğŸ› ï¸ æ ¸å¿ƒæ¶æ„ï¼šCrucible Protocol

æœ¬é¡¹ç›®éµå¾ªä¸¥è‹›çš„ **Crucible åè®®**ï¼Œè¿™æ˜¯ä¸€å¥—é›†æˆå¤–éƒ¨çŸ¥è¯†ä¸å†…éƒ¨å¯¹æŠ—çš„é—­ç¯ç³»ç»Ÿï¼š

1.  **Phase 0: Oracle Scanning (å…¨çŸ¥æ‰«æ)**
    -   **é›·è¾¾é”å®š**: åœ¨è¾©è®ºå‰å¤•ï¼Œè‡ªåŠ¨è°ƒåŠ¨ `oracle_scanner.py` æ‰«ææ–‡æ¡£ä¸­çš„çŸ¥è¯†ç›²åŒºã€‚
    -   **äº‹å®é”šå®š**: é€šè¿‡ `Find -> Verify -> Inject` å¾ªç¯ï¼Œå°†å¤–éƒ¨å®æ—¶æ•°æ®æ³¨å…¥æœ¬åœ°çŸ¥è¯†åº“ (`docs/knowledge/`)ï¼Œé˜²æ­¢é—­é—¨é€ è½¦ã€‚

2.  **Phase 1: Council Debate (ç†äº‹ä¼šè¾©è®º)**
    -   **å¤šæ¨¡æ€å¯¹æŠ—**: è°ƒç”¨é¡¶çº§ LLM (DeepSeek/Qwen/GLM) åˆ†åŒºæ‰®æ¼” Affirmative (ä»·å€¼æå«è€…) ä¸ Negative (é£é™©å®¡è®¡å‘˜)ã€‚
    -   **äº‹å®å¯¹æŠ—**: Negative è§’è‰²è¢«å¼ºåˆ¶è¦æ±‚åŸºäº Oracle æä¾›çš„çŸ¥è¯†è¿›è¡Œæ”»å‡»ï¼Œè€Œéå‡­ç©ºè´¨ç–‘ã€‚

3.  **Phase 2: Adjudication & Mending (è£å†³ä¸ä¿®è¡¥)**
    -   **å…ƒè£å†³**: Adjudicator ç»¼åˆåŒæ–¹è®ºç‚¹ä¸äº‹å®ä¾æ®ï¼Œç»™å‡ºé‡åŒ–è¯„åˆ†ä¸å¼ºåˆ¶æ€§çš„ "Mending Orders" (ä¿®è¡¥æŒ‡ä»¤)ã€‚
    -   **é€€å‡ºæœºåˆ¶**: åªæœ‰å½“è¯„åˆ† >90 æˆ–è¾¾åˆ°æœ€å¤§å¾ªç¯æ¬¡æ•°æ—¶ï¼Œç†”ç‚‰æ‰ä¼šå¼€å¯å‡ºå£ã€‚

4.  **Phase 3: Surgical Action (å¤–ç§‘æ‰‹æœ¯)**
    -   **ç²¾å‡†æ‰§è¡Œ**: Agent æ‰§è¡Œ Adjudicator çš„æŒ‡ä»¤ï¼Œå¯¹æ–‡æ¡£è¿›è¡ŒåŸå­åŒ–ä¿®æ”¹ã€‚
    -   **å®¡è®¡æ—¥å¿—**: æ¯ä¸€æ¬¡å‚æ•°ä¿®æ­£ä¸é€»è¾‘è°ƒæ•´éƒ½è¢«è®°å½•åœ¨æ¡ˆã€‚

---

## ğŸ“‚ ç³»ç»Ÿç‰ˆå›¾

| æ¨¡å—           | æ ¸å¿ƒç»„ä»¶                                                               | èŒè´£æè¿°                                                                            |
| :------------- | :--------------------------------------------------------------------- | :---------------------------------------------------------------------------------- |
| **`.agent/`**  | **`/workflows/`**                                                      | **æˆ˜ç•¥ç¼–æ’å™¨**: åŒ…å« `crucible.md` (ç†”ç‚‰åè®®) ç­‰æ ‡å‡†ä½œä¸šç¨‹åº (SOP)ã€‚                |
| **`llm/`**     | **`client.py`**<br>**`config.json`**                                   | **æ¨ç†ä¸­æ¢**: ç»Ÿä¸€çš„ LLM æ¥å£ç½‘å…³ï¼Œé›†æˆ DeepSeek/Qwen/GLMã€‚æ”¯æŒåŠ¨æ€ Token ç®¡ç†ã€‚    |
| **`prompts/`** | **`*.md`**                                                             | **è®¤çŸ¥é…ç½®**: å­˜å‚¨ `negative.md`, `adjudicator.md` ç­‰ç³»ç»Ÿæç¤ºè¯ï¼Œå®šä¹‰ AI è®¤çŸ¥è¾¹ç•Œã€‚ |
| **`scripts/`** | **`oracle_scanner.py`**<br>**`dialecta_debate.py`**<br>**`pdf_tool/`** | **æ‰§è¡Œå¼•æ“**: çŸ¥è¯†æ‰«æã€è¾©è®ºè°ƒåº¦ã€PDF äº¤ä»˜ã€‚                                        |
| **`docs/`**    | **`knowledge/`**<br>**`reports/`**                                     | **èµ„äº§ä»“åº“**: éš”ç¦»å­˜å‚¨å¤–éƒ¨äº‹å®çŸ¥è¯†åº“ä¸è¾©è®ºæ¡£æ¡ˆã€‚                                    |

---

## ğŸ—ï¸ æ¶æ„ä¹‹é­‚ï¼šSystem Panorama

```mermaid
flowchart TB
    %% ======================================================================================
    %% ğŸ¨ è§†è§‰é£æ ¼å®šä¹‰
    %% ======================================================================================
    classDef userSpace fill:#eff6ff,stroke:#1e40af,stroke-width:2px,color:#1e3a8a;
    classDef workflow fill:#f8fafc,stroke:#475569,stroke-width:2px,stroke-dasharray: 5 5,color:#334155;
    classDef script fill:#1e293b,stroke:#94a3b8,stroke-width:1px,color:#fff;
    classDef agent fill:#7c3aed,stroke:#4c1d95,stroke-width:3px,color:#fff;
    classDef db fill:#ecfccb,stroke:#4d7c0f,stroke-width:2px,color:#365314;
    classDef doc fill:#fff7ed,stroke:#c2410c,stroke-width:2px,color:#7c2d12;
    classDef web fill:#cffafe,stroke:#0891b2,stroke-width:1px,color:#155e75;

    %% ======================================================================================
    %% ç¬¬ 1 å±‚ï¼šäº¤äº’å…¥å£
    %% ======================================================================================
    subgraph UserSpace [ğŸ”µ ç¬¬ 1 å±‚: ç”¨æˆ·æŒ‡ä»¤]
        CMD["ğŸ’» /crucible<br/>(å¯åŠ¨ç†”ç‚‰)"]:::userSpace
    end

    %% ======================================================================================
    %% ç¬¬ 2 å±‚ï¼šå¼•æ“æ ¸å¿ƒ
    %% ======================================================================================
    subgraph Engine [âš™ï¸ ç¬¬ 2 å±‚: SparkForge å¼•æ“]
        direction TB
        
        SOP(["Workflow: crucible.md<br/>(SOP æ ‡å‡†ä½œä¸šç¨‹åº)"]):::workflow
        
        subgraph Phase0 [é˜¶æ®µ 0: å…¨çŸ¥æ‰«æ]
            direction LR
            Scanner[["ğŸ”® oracle_scanner.py<br/>(çŸ¥è¯†é›·è¾¾)"]]:::script
            WWW(("ğŸŒ äº’è”ç½‘æœç´¢")):::web
            Scanner <--> WWW
        end

        subgraph Phase1 [é˜¶æ®µ 1: ç†äº‹ä¼šè¾©è®º]
            direction TB
            Debater[["âš–ï¸ dialecta_debate.py<br/>(è¾©è®ºä¸»æ§)"]]:::script
            
            subgraph Council [ğŸ§  è®¤çŸ¥å¯¹æŠ—åŒº]
                Aff("ğŸ›¡ï¸ æ­£æ–¹<br/>(ä»·å€¼æå«)"):::agent
                Neg("ğŸ—¡ï¸ åæ–¹<br/>(é£é™©å®¡è®¡)"):::agent
                Adj("ğŸ§‘â€âš–ï¸ è£å†³å®˜<br/>(Adjudicator)"):::agent
            end
            
            Debater --- Aff & Neg
            Aff & Neg ==> Adj
        end
        
        subgraph Phase3 [é˜¶æ®µ 2: å¤–ç§‘æ‰‹æœ¯]
            Surgeon{{"âš¡ æ‰§è¡Œ Agent<br/>(ç²¾å‡†ä¿®æ”¹)"}}:::agent
        end
    end

    %% ======================================================================================
    %% ç¬¬ 3 å±‚ï¼šæ•°æ®èµ„äº§
    %% ======================================================================================
    subgraph Storage [ğŸ“‚ ç¬¬ 3 å±‚: é¡¹ç›®èµ„äº§]
        Store_Know[("ğŸ§  çŸ¥è¯†åº“<br/>(docs/knowledge/)")]:::db
        Store_Report[("ğŸ“œ è¾©è®ºæ¡£æ¡ˆ<br/>(docs/reports/)")]:::db
        Target_Doc["ğŸ“„ ç›®æ ‡æ–‡æ¡£"]:::doc
    end

    %% ======================================================================================
    %% ğŸ”— æ•°æ®æµé€»è¾‘
    %% ======================================================================================
    
    %% å¯åŠ¨
    CMD ==> SOP
    
    %% é˜¶æ®µ 0: çŸ¥è¯†æ³¨å…¥
    SOP -->|â‘  æ‰«æç›²åŒº| Scanner
    Scanner ==>|æ³¨å…¥äº‹å®| Store_Know
    
    %% é˜¶æ®µ 1: äº‹å®é”šå®šè¾©è®º
    SOP -->|â‘¡ å‘èµ·è¾©è®º| Debater
    Debater -->|è¯»å–| Target_Doc
    Store_Know -.->|äº‹å®æ”¯æ’‘| Neg
    Adj ==>|å¼ºåˆ¶æŒ‡ä»¤ Mending Orders| SOP
    Adj -.->|å½’æ¡£| Store_Report
    
    %% é˜¶æ®µ 2: æ‰§è¡Œ
    SOP -->|â‘¢ æ‰§è¡ŒæŒ‡ä»¤| Surgeon
    Surgeon ==>|åŸå­åŒ–å†™å…¥| Target_Doc
```

---

## ğŸš€ æ ¸å¿ƒå·¥ä½œæµï¼šThe Crucible

è¿™æ˜¯ SparkForge çš„ç»ˆæå½¢æ€ã€‚

### 1. å¯åŠ¨ç†”ç‚‰

åœ¨ IDE ä¸­æ‰“å¼€ç›®æ ‡æ–‡æ¡£ï¼Œè¾“å…¥æŒ‡ä»¤ï¼š

```bash
/crucible "ä¼˜åŒ–ç›®æ ‡æè¿°"
```

**å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ**
1.  **Oracle æ‰«æ**: ç³»ç»Ÿé¦–å…ˆè¿è¡Œ `oracle_scanner.py`ï¼Œæ‰¾å‡ºæ–‡æ¡£ä¸­çš„å¼±ç‚¹ï¼ˆå¤–éƒ¨çŸ¥è¯†ç›²åŒºï¼‰ã€‚
2.  **çŸ¥è¯†æ³¨å…¥**: æœ€æ–°é²œçš„å¤–éƒ¨äº‹å®ï¼ˆæ³•è§„ã€æ•°æ®ã€æ¡ˆä¾‹ï¼‰è¢«å­˜å…¥ `docs/knowledge/`ã€‚
3.  **ç†äº‹ä¼šè¾©è®º**: `dialecta_debate.py` å¯åŠ¨ï¼ŒNegative è¾©æ‰‹æ‰‹æŒ Oracle çŸ¥è¯†å¯¹æ–‡æ¡£å‘èµ·çŒ›çƒˆæ”»å‡»ã€‚
4.  **è£å†³ä¸ä¿®è¡¥**: æœ€åï¼ŒAgent æ ¹æ®è£å†³ç»“æœï¼Œå¯¹æ–‡æ¡£è¿›è¡Œç²¾å‡†ä¿®æ”¹ã€‚
5.  **å¾ªç¯**: è¿™ä¸ªè¿‡ç¨‹ä¼šè‡ªåŠ¨å¾ªç¯ (Loop 1 -> Loop 2...)ï¼Œç›´åˆ°æ–‡æ¡£è¾¾åˆ° 90 åˆ†æˆ–ç”¨æˆ·æ»¡æ„ã€‚

### 2. è¾…åŠ©å·¥å…·é“¾

#### ğŸ”® Oracle Scanner (æ‰‹åŠ¨è§¦å‘)
å¦‚æœä½ åªæƒ³æ£€æŸ¥æ–‡æ¡£çš„çŸ¥è¯†ç›²åŒºï¼Œè€Œä¸è¿›è¡Œå®Œæ•´è¾©è®ºï¼š
```bash
python3 scripts/oracle_scanner.py {æ–‡æ¡£è·¯å¾„}
```

#### âš–ï¸ Dialecta Debate (æ‰‹åŠ¨è§¦å‘)
å¦‚æœä½ å·²æœ‰çŸ¥è¯†åº“ï¼Œåªæƒ³è¿›è¡Œé€»è¾‘å®¡è®¡ï¼š
```bash
python3 scripts/dialecta_debate.py {æ–‡æ¡£è·¯å¾„} --oracle {knowledge_file}
```

#### ğŸ“„ PDF Export (äº¤ä»˜)
å°†æ‰“ç£¨å¥½çš„æ–‡æ¡£å¯¼å‡ºä¸ºç²¾ç¾ PDFï¼š
```bash
make glass {æ–‡æ¡£è·¯å¾„}  # é€‚åˆç§»åŠ¨ç«¯é˜…è¯»çš„é•¿å›¾é£æ ¼
make a4 {æ–‡æ¡£è·¯å¾„}     # é€‚åˆæ‰“å°çš„å•†åŠ¡é£æ ¼
```

---

## ğŸ¨ æ ¸å¿ƒè®¾è®¡å“²å­¦

-   **Oracle Grounding (äº‹å®é”šå®š)**: å†…éƒ¨é€»è¾‘å†å®Œç¾ï¼Œå¦‚æœè¿èƒŒå¤–éƒ¨äº‹å®ï¼ˆæ³•è§„ã€ç‰©ç†å®šå¾‹ã€å¸‚åœºæ•°æ®ï¼‰ï¼Œä¹Ÿæ˜¯åºŸå“ã€‚
-   **Adversarial Resilience (å¯¹æŠ—é²æ£’æ€§)**: æ²¡æœ‰ç»è¿‡æ”»å‡»çš„è§‚ç‚¹æ˜¯ä¸å€¼å¾—ä¿¡ä»»çš„ã€‚
-   **Audit Trail (å®¡è®¡ç•™ç—•)**: æ¯ä¸€æ¬¡å†³ç­–ã€æ¯ä¸€ä¸ªå‚æ•°çš„ä¿®æ”¹ï¼Œéƒ½å¿…é¡»å¯è¿½æº¯ã€‚

---

Â© 2025 SparkForge High-Fidelity Intelligence Engine.

